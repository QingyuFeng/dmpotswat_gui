# DMPOTSWAT User Manual

Distributed Model Parameter Optimization Tool for the SWAT model, dmpotswat, is a tool for conducting multivariable and multisite calibration of the SWAT model with the distributed optimization procedure.

## What is distributed model parameter optimization?

Distributed model parameter optimization conducts parameter optimization in a distributed way. There are generally two schemes for multisite calibration. One is simultaneous scheme which determines one optimal solution of parameter sets producing satisfactory calibration results for the whole
watershed. The other scheme is sequential scheme which optimizes objective functions in a cascading way. The determined optimal solution by the simultaneous scheme assumes that the selected optimal set of parameter values fits the whole watersheds. By assuming only one optimal parameter sets, spatial variation of hydrologic responses to geographical conditions in the calibration procedure is not fully captured. Thus, the simultaneous scheme might be suitable for calibrating models of watersheds with less geographic heterogeneity. For watersheds with large area or higher geographical heterogeneity, the optimal solution for the whole watershed cannot fit all areas. The solution is only "partially optimal" for
parts of the watershed instead of "global optimal" for the whole watershed. The scheme generating only one optimal solution for the whole watershed can be considered as "lumped optimization", even though the parameter values are setup in a distributed way. In order to fully capture the spatial variations of hydrologic processes, the modification of parameter values for multiple gauging stations need not to be identical but should be based on conditions of sub-watersheds as in the sequential scheme. The distributed model parameter optimization mode initialize parameters for each subarea group defined by users, and optimize them individually.

## Get started

This program is compiled into one executable file, and can be started by double click it. No installation is needed.

After started, the interface looks like this:

![1660545983190](image/Dmpotswat_Manual_Chinese/1660545983190.png)

The interface contains 10 labels:

* Projects: Under this lable, users can create, save, or load existing projects.
* SWAT Model：Under this label, details for the SWAT model simulation can be specified. These details includes start and ending dates, warm up period, outlet to be calibrated, variables at each outlet to be calibrated, objective functions used for each target, and their weights if multiple variable and outlet are to be included in one calibration.
* Evaluate Default Model: Under this label, users can calculate values of objective functions and evaluate the model with default parameter values.
* Parameter Selection: Under this label, users can determine target parameters to be included in the calibration process.
* Sensitivity analysis：Under this label, users can conduct sensitivity analysis.
* Calibration: Under this label, users can specify details and conduct calibration.
* Calibration Plotting: Under this label, users can plot the time series plot and flow duration curve plots for any specified run no during the calibration. This label is designed to facilitate the selection of best run no.
* Select Best Run: Under this label, users can select the best run no, and apply the parameters of this run to the txtinout and get calibrated model. Users can also get validated model by setting up the validation period under the SWAT model label.
* Uncertainty: Under this label, users can generate uncertainty maps.
* About: Description of the software.

1. Projects Label：

Users can create a new project by clicking the "Create New Project" button. Users need to select a folder where the project will stored. Then, a file with suffix of ".dmp" will be created,

![1660547589741](image/Dmpotswat_Manual_Chinese/1660547589741.png)

as well as several folders shown in the figure below:
![1660547663647](image/Dmpotswat_Manual_Chinese/1660547663647.png)

* observeddata: folder storing files containing time series of observed values for selected variables at corresponding outlet.
* outfiles_dds: folder containing files generated during the DDS procedure, including values of objective function, parameters, and selection of parameters at each run no.
* outfiles_sa: folder containing files generated during the process of sensitivity analysis
* reachshapefile: folders containing the reach.shp file generated by ArcSWAT
* txtinout: folders containing files for the original TxtInOut folder for the model
* workingdir: folders containing a copy of the txtinout folder

After the project setup is done, corresponding information will be displayed in the text box within the label:

![1660551270652](image/Dmpotswat_Manual_Chinese/1660551270652.png)

After creating the project, users need to copy all files in the TxtInOut folder into the txtinout folder under the project folder. In addition, the reach.shp file need also be copied to the reachshapefile folder under the project folder. Then, check the corresponding checkbox. The software will make some basic inspection to determine whether these folders are properly prepared. After copying these files, users can click the "Save Project" button to save the project, and enable the SWAT Model label.

If users have an existing project, they can click the "Open Existing Project" button to load it.

2. SWAT Model Label

This label will be enabled after the project is created and saved.

Under this label, the parameters to be specified includes: Simulation start date, End date, Warmup period, Time frequency (print frequency of the SWAT model), and Total No of outlet_variable. The Total No of outlet_variable refers to the total number of variables at all outlets. For example, there are two outlets to be calibrated. Two variables (say streamflow and sediment) need to be calibrated at the first outlet, and one variable (say streamflow) will be calibrated at the second outlet. Then, the Total No of outlet_variable should be set as 3. Maximum number of outlet_variable allowed by this software is 15.

Then, users need to define the specified outlet variables by clicking the "Define Details" button. Then, a table showing the available variables, options for objective functions, and their weights will be displayed. Users need to enter the outlet No available in the watershed, the variables at this outlet, weights of this outlet_variable, objective function to be calculated, and the weights of each objective function. Weights can be exact or fuzzy weights. The fuzzy weights refers to relative large or small numbers. The software will use standardized weights calculated as weights/(maximum weights - minimum weights) as the actual weights during the calibration.
After finished setting up the details, click the "Save Details" button to save the setting.

After setting up the details, users need to copy files containing observed time series for each outlet_variable into the observeddata folder under the project folder. Then, users need to check the checkbox after the "Clear Table" button. The software will check whether observed data are all preapared properlly. If not, error message will be displayed showing the problem.

![1660551519647](image/Dmpotswat_Manual_Chinese/1660551519647.png)

After details of the SWAT model is properly setup, other labels will be activated.

3. Evaluate Default Model Label:

Under this label, users can calculate the values of selected objective functions for each outlet_variale will be calculated by running the model with default parameters. This label is designed to provide users with a glance of model performance with default parameters. During the running process, the software will first copy files in the txtinout folder into the workingdir. Then, call the SWAT.exe program. After the program finished running, the software will calculate the objective functions and display in the textbox within this label.

![1660569719508](image/Dmpotswat_Manual_Chinese/1660569719508.png)

4. Parameter selection Label

Under this label, users can select parameters to be calibrated. Besides, users can modify the initial values, minimum and maximum values of each parameter. Totally, 66 parameters for calibrating Flow, Sediment, Nitrogen, and Phosphorus are included. After finished selection, click the Save Parm Selection button to save the settings. Extra buttons for selecting and deselecting all parameters for flow, sediment, N and P were provided to facilitate the selection process.

![1660569946718](image/Dmpotswat_Manual_Chinese/1660569946718.png)

5. Sensitivity Analysis Label

Under this label, users can conduct sensitivity analysis with three methods, including the Sobol, Morris, and FAST. These algorims are conducted by calling corresponding functions in the Salib python package. Details of this package are available at [SALib - Sensitivity Analysis Library in Python — SALib 1.4.6b1.post1.dev2+g00d8e47.d20220712 documentation](https://salib.readthedocs.io/en/latest/index.html). After setting the values for corresponding method and finished running the process of sensitivity analysis, the results will be stored in the outfiles_sa folder under the project folder.

![1660570973335](image/Dmpotswat_Manual_Chinese/1660570973335.png)

6. Calibration Label:

Under this label, users can conduct calibration with the Dynamic Dimension Search (DDS) algorithm to optimize the parameter for the SWAT model.
There are several details to be specified before starting the calibration process:

* calibration mode: two modes were provided. Including the distributed mode and the calibrated model. Description of the modes are available at the first section of this manual.
* initial parameter values: two options are provided. The first option is random value option, by which a random value within the range of minimum and maximum values will be generated for each parameter as the starting point of the calibration process. The second option is the initial value, by which the initial value specified in the Parameter Label will be used as the starting point of the calibration process. The difference of these two option only affect the calibration during the first several runs of the total iterations. As parameters will be updated based on the evolution process of the objective functions.
* pertubation factor: this factor determined the sampling step during the DDS procedure. By default, it is 0.2.
* total iterations：Total iteration no to run. This number has two purposes: 1) determine the stopping no (for example 100). 2) determine the numbers of parameters to be selected at each run (for example 25) by the formula: probability = 1 - log(25)/log(100) = 0.301。This probability is used to determine the chance whether a parameter is selected in run 25. The logic of this method was that the number of parameters to be modified decreased with the proceeding of the DDS procedure.
  ![1660616580335](image/Dmpotswat_Manual_Chinese/1660616580335.png)

  The y axis of the following figure shows the selection of one parameter during each run. Black bars indicates that one parameter is selected while white bars indicated that the parameter is not selected. This figure shows that the parametes participating the calibration process is decreased in later runs.

  ![1660616261948](image/Dmpotswat_Manual_Chinese/1660616261948.png)
* restart mode: new run or continue with what left in the last run, if last run is less than the total iteration number. The software will determine the runno by checking results in outfiles_dds folder.

![1660574786733](image/Dmpotswat_Manual_Chinese/1660574786733.png)

7. Calibration Plotting Label

Under this label, users can generate both time series plot and flow dueration curve for any run no during the total iteration. By clicking the "Define Plot Details" button, users can specify the run no and select target plot type. Then, users need to click the "Save plot details" button to save the specification and then the "Create plots" button to generate the plots. The plots will be saved under the outfiles_dds folder.

![1660727780079](image/Dmpotswat_Manual_Chinese/1660727780079.png)

Examples of the time series plot and duration curve are shown below:

![1660727884600](image/Dmpotswat_Manual_Chinese/1660727884600.png)

![1660727866667](image/Dmpotswat_Manual_Chinese/1660727866667.png)

8. Select Best Run Label

Under this label, users can select the best run number by checking the values of objective functions at each run. By clicking the "Select Best Parameter Set" button, a table showing the values will be displayed. Then, users need to click on the target run to select the run no. Then, determine the purpose of the best run. This selection are mainly for labeling the output folders storing the files of the model containing best parameters from the select run no. Users can use the Calibration Plotting label to help determine the run no that provides best run no. After selecting the run no, users can click the "Run with Best Parameter Set" button to run the model with best run no. A copy of the txtinout folder will be made. The plot function is also provided and the two types of plots for the best run will be generated.

![1660728524883](image/Dmpotswat_Manual_Chinese/1660728524883.png)

9. Uncertainty Label

Under this label, the uncertainty plot is generated. By selecting the best iteration number, and click the "Run Uncertainty Plot" button, a time series plot showing the simulation results within 95% of the simulated variable values will be generated.

![1660728716936](image/Dmpotswat_Manual_Chinese/1660728716936.png)

An example of the uncertainty plot is shown below；

![1660728748906](image/Dmpotswat_Manual_Chinese/1660728748906.png)
